<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PWT63X64');</script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BX0P85DZ7T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-BX0P85DZ7T');
  </script>

  <title>ì‹œê·¸ë‹ˆì²˜ í–¥ê¸° ì»¨ì„¤íŒ…</title>
  <meta property="og:type" content="website">
  <meta property="og:title" content="ì‹œê·¸ë‹ˆì²˜ í–¥ê¸° ì»¨ì„¤íŒ…">
  <meta property="og:description" content="ì‚¬ì „ì˜ˆì•½ ì‹œ í–¥ê¸°í‚¤íŠ¸ ë¬´ë£Œì¦ì •!">
  <meta property="og:url" content="https://perfume-kappa-eight.vercel.app/">
  <meta property="og:image" content="https://perfume-kappa-eight.vercel.app/sample.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#faf8f5; --text:#4a4037; --muted:#8b7355;
      --accent-warm:#d4a574; --accent-soft:#b8956a;
      --cardBgTop: rgba(255,252,247,.95); --cardBgBottom: rgba(248,245,240,.85);
      --cardBorder: rgba(180,149,106,.15);
      --cta-from:#c4956c; --cta-to:#a67c52; --timer-emph:#c17817;
      --cloud-light: rgba(255,255,255,.6); --cloud-medium: rgba(248,245,240,.8);
    }
    html,body{
      background:
        radial-gradient(1200px 800px at 80% -10%, rgba(212,165,116,.08), transparent 60%),
        radial-gradient(900px 600px at 10% 10%, rgba(184,149,106,.06), transparent 60%),
        radial-gradient(600px 400px at 50% 50%, rgba(255,252,247,.4), transparent 70%),
        var(--bg);
      color:var(--text);
      font-family:"Pretendard", system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    }
    .glass{ background:linear-gradient(180deg, var(--cloud-light), rgba(255,252,247,.4)); border:1px solid rgba(212,165,116,.2); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(212,165,116,.08);}
    .soft{ background:linear-gradient(180deg, var(--cardBgTop), var(--cardBgBottom)); border:1px solid var(--cardBorder); box-shadow: 0 2px 15px rgba(180,149,106,.1); }
    .rec-badge{ background: linear-gradient(90deg, rgba(212,165,116,.25), rgba(184,149,106,.25)); color: #8b7355; border:1px solid rgba(212,165,116,.4); }
    .shine{position:relative; overflow:hidden}
    .shine::after{content:""; position:absolute; top:-120%; left:-40%; width:40%; height:300%; transform: rotate(25deg); background: linear-gradient(90deg, transparent, rgba(255,255,255,.6), transparent); animation: shine 2.6s infinite;}
    @keyframes shine { 0%{left:-60%} 60%{left:120%} 100%{left:120%} }
    .big-num{ font-variant-numeric: tabular-nums; letter-spacing: -0.02em; }
    .hero-title{ font-size: 36px; line-height: 1.12; word-break: keep-all; hyphens: auto; }
    @media (min-width: 1024px){ .hero-title{ font-size: 40px; } }
    @media (max-width: 640px){
      .hero-title{ font-size: 28px; line-height: 1.3; }
      .hero-sub{ font-size: 16px; line-height: 1.6; }
      .mobile-text{ font-size: 16px; line-height: 1.5; }
      .mobile-title{ font-size: 24px; line-height: 1.3; }
      .mobile-large{ font-size: 20px; line-height: 1.3; }
    }
    .popup-backdrop{ position: fixed; inset:0; background: rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index: 200; }
    .popup-shell{ width: 90%; max-width: 480px; background: white; border-radius: 20px; overflow:hidden; box-shadow: 0 20px 40px rgba(0,0,0,.2); }
    .popup-backdrop.show{ display:flex; }
    .report-backdrop{ position: fixed; inset:0; background: rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index: 300; }
    .report-shell{ width: 90%; max-width: 800px; background: white; border-radius: 20px; overflow:hidden; box-shadow: 0 20px 40px rgba(0,0,0,.3); max-height: 90vh; overflow-y: auto; }
    .report-backdrop.show{ display:flex; }
  </style>
</head>
<body class="min-h-screen">
  <!-- íŒì—… -->
  <div class="popup-backdrop" id="welcomePopup">
    <div class="popup-shell relative">
      <div class="absolute top-4 right-5 cursor-pointer text-2xl text-gray-400" onclick="closePopup()">&times;</div>
      <div class="p-6 md:p-8 text-center">
        <h2 class="text-2xl md:text-3xl font-bold mb-4 leading-tight" style="color: var(--text);">
          "ê³ ê°ì€ ê¸°ì–µí•©ë‹ˆë‹¤.<br>ê³µê°„ì´ ì–´ë–¤ í–¥ì´ì—ˆëŠ”ì§€."<br>
          <span class="text-lg md:text-xl text-orange-600 font-semibold">í”„ë¦¬ë¯¸ì—„ í–¥ê¸° ì†”ë£¨ì…˜ "ì‚¬ì „ì˜ˆì•½ OPEN"</span>
        </h2>
        <div class="space-y-3 mb-6 text-left">
          <div class="flex items-start gap-3"><span class="text-xl">âœ¨</span><span class="text-sm md:text-base">ê³µê°„ëŒ€ì—¬/ìˆ™ë°•ì—…ì„ ìœ„í•œ ë§ì¶¤í˜• í–¥ê¸° ì»¨ì„¤íŒ…</span></div>
          <div class="flex items-start gap-3"><span class="text-xl">ğŸ’¡</span><span class="text-sm md:text-base">íƒˆì·¨ + í–¥ê¸° + ì •ê¸° êµ¬ë…ê¹Œì§€ í•œ ë²ˆì—</span></div>
          <div class="flex items-start gap-3"><span class="text-xl">ğŸ’Œ</span><span class="text-sm md:text-base">ì§€ê¸ˆ ì‚¬ì „ì˜ˆì•½í•˜ë©´, ëª…í’ˆ ë¸Œëœë“œ í–¥ 3ì¢… ë¬´ë£Œ</span></div>
        </div>
        <a href="#" onclick="closePopup(); window.scrollTo({top: 0, behavior: 'smooth'}); return false;" class="w-full inline-flex justify-center shine rounded-2xl bg-gradient-to-r from-[var(--cta-from)] to-[var(--cta-to)] text-white font-semibold px-6 py-4 text-base md:text-lg">
          í–¥ê¸° ì»¨ì„¤íŒ… ì‚¬ì „ì˜ˆì•½í•˜ê³  í–¥ê¸°í‚¤íŠ¸ ë°›ê¸°
        </a>
      </div>
    </div>
  </div>

  <!-- ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸° íŒì—… -->
  <div class="report-backdrop" id="reportPreview">
    <div class="report-shell relative">
      <div class="absolute top-4 right-5 cursor-pointer text-2xl text-gray-400" onclick="closeReportPreview()">&times;</div>
      <div class="p-6 md:p-8">
        <h2 class="text-2xl md:text-3xl font-bold mb-4 text-center" style="color: var(--text);">ğŸ“Š í–¥ê¸° ì»¨ì„¤íŒ… ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸°</h2>
        <p class="text-center mb-6 text-gray-600">ì‹¤ì œ ì»¨ì„¤íŒ…ì—ì„œ ì œê³µë˜ëŠ” ë ˆí¬íŠ¸ ìƒ˜í”Œì…ë‹ˆë‹¤</p>
        <div class="grid grid-cols-3 gap-3 mb-6">
          <img src="https://i.imgur.com/QNgA4yX.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
          <img src="https://i.imgur.com/kTAobyG.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
          <img src="https://i.imgur.com/PQHgUHC.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
          <img src="https://i.imgur.com/G3gpDgR.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
          <img src="https://i.imgur.com/RbYVFuF.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
          <img src="https://i.imgur.com/E1Yqf41.jpeg" class="w-full h-48 object-cover rounded-xl" onerror="this.style.display='none';">
        </div>
        <div class="text-center">
          <p class="text-sm text-gray-500 mb-4">* ì‹¤ì œ ë ˆí¬íŠ¸ëŠ” ê³ í•´ìƒë„ë¡œ ì œê³µë©ë‹ˆë‹¤</p>
          <a href="https://forms.gle/wbR4GTb5Rz7Q4yZY6" target="_blank" class="inline-flex justify-center shine rounded-2xl bg-gradient-to-r from-[var(--cta-from)] to-[var(--cta-to)] text-white font-semibold px-6 py-4 text-lg">
            ì»¨ì„¤íŒ… ì‚¬ì „ì˜ˆì•½í•˜ê³  ìƒì„¸ ë ˆí¬íŠ¸ ë°›ê¸°
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Sticky CTA -->
  <div class="sticky top-2 z-50">
    <div class="mx-auto max-w-5xl px-4">
      <div class="glass rounded-2xl p-3 md:p-4 flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-orange-100 text-orange-600">ğŸ’¬</span>
          <p class="text-sm md:text-base mobile-text" style="color: var(--text);">ëª…í’ˆ ë¸Œëœë“œ í–¥ê¸°í‚¤íŠ¸ 3ì¢…(10ml) ë¬´ë£Œ ì¦ì •!</p>
        </div>
        <a href="#action"
           onclick="gtag('event','click_booking_cta',{section:'sticky'});"
           class="shine rounded-xl bg-gradient-to-r from-[var(--cta-from)] to-[var(--cta-to)] text-white font-semibold px-4 py-2 md:px-6 md:py-3 hover:opacity-95 transition">
          ì»¨ì„¤íŒ… ì‚¬ì „ì˜ˆì•½í•˜ê¸°
        </a>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ -->
  <main class="mx-auto max-w-6xl px-4 md:px-6 lg:px-8 pt-10 md:pt-16 pb-28">
    <!-- Hero -->
    <section class="grid lg:grid-cols-2 gap-8 items-center">
      <div class="space-y-6">
        <div class="inline-flex items-center gap-2 text-xs font-medium px-3 py-1 rounded-full rec-badge">í–¥ê¸°ë¡œ ë§Œë“œëŠ” ê³µê°„ ë¸Œëœë”©</div>
        <h1 class="hero-title font-extrabold" style="color: var(--text);">ê³µê°„ì„ ë°”ê¾¸ëŠ”<br>ì‹œê·¸ë‹ˆì²˜ í–¥ê¸° ì»¨ì„¤íŒ…</h1>
        <p class="hero-sub text-base md:text-lg" style="color: var(--muted);">ë‹¨ í•œ ë²ˆì˜ ê²½í—˜ìœ¼ë¡œ ì™„ë²½í•œ ë³€í™”ë¥¼,<br>í”„ë¦¬ë¯¸ì—„ í–¥ê¸° ì†”ë£¨ì…˜ ì¶œì‹œ ì˜ˆì •!</p>
        <div class="flex flex-col gap-2">
          <a href="#action"
             onclick="gtag('event','click_booking_cta',{section:'hero'});"
             class="shine rounded-2xl bg-gradient-to-r from-[var(--cta-from)] to-[var(--cta-to)] text-white font-semibold px-6 py-4 text-lg text-center">
            ì»¨ì„¤íŒ… ì‚¬ì „ì˜ˆì•½í•˜ê¸°
          </a>
          <span class="text-sm md:text-base text-center sm:text-left" style="color: var(--muted);">ê³ ê°ì´ ê¸°ì–µí•˜ëŠ” ê³µê°„ì„ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´?</span>
        </div>
      </div>

      <div class="soft rounded-3xl p-6 md:p-8 flex flex-col items-center justify-center">
        <div class="glass rounded-2xl p-4 w-full max-w-sm">
          <img src="https://i.imgur.com/PSKXkuf.jpeg" alt="í”„ë¦¬ë¯¸ì—„ í–¥ê¸°í‚¤íŠ¸ 3ì¢…" class="w-full h-64 object-cover rounded-xl" onerror="this.src=''; this.alt='ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'; this.style.display='none';">
        </div>
        <p class="text-sm mt-3 text-center" style="color: var(--muted);">&lt;ëª…í’ˆ ë¸Œëœë“œ í–¥ê¸°í‚¤íŠ¸ 3ì¢… ì¦ì •&gt;</p>
      </div>
    </section>

    <!-- (ì¤‘ê°„ ì„¹ì…˜ë“¤ì€ ê·¸ëŒ€ë¡œ â€” ìƒëµ ì—†ì´ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€) -->
    <!-- ... ê¸°ì¡´ Problem / Social Proof / USP / Packages / Sample / Action / FAQ ê·¸ëŒ€ë¡œ ... -->

    <!-- Packages -->
    <section>
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-xl md:text-3xl mobile-title font-bold">"ìš°ë¦¬ ìˆ™ì†Œì— ë§ëŠ” í–¥ê¸° í”Œëœ ì°¾ê¸°"</h2>
          <p class="mt-1 text-sm" style="color: var(--muted);">3ê°€ì§€ ì˜µì…˜ì„ ë¹„êµí•˜ê³  ì„ íƒí•˜ì„¸ìš”</p>
        </div>
        <button type="button"
          onclick="gtag('event','click_report_preview',{device:'desktop'}); showReportPreview();"
          class="hidden md:inline-flex items-center gap-2 shine rounded-xl bg-gradient-to-r from-purple-600 to-purple-700 text-white font-semibold px-5 py-3">
          ğŸ‘€ ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸°
        </button>
      </div>

      <div class="grid lg:grid-cols-3 gap-6">
        <div class="glass rounded-2xl p-6">
          <div class="text-sm mb-2" style="color: var(--muted);">Standard</div>
          <h3 class="text-lg font-semibold">ê°€ì¥ ë¹ ë¥´ê³  í•©ë¦¬ì ì¸ ëƒ„ìƒˆ í•´ê²°</h3>
          <ul class="mt-4 space-y-2 text-sm" style="color: var(--muted);">
            <li>â€¢ ê¸°ë³¸ ì§„ë‹¨ + ì¦‰ì‹œ ì ìš© ê°€ì´ë“œ</li>
            <li>â€¢ ì˜ˆì‚°í˜• ì œí’ˆ ì¶”ì²œ</li>
            <li>â€¢ ì…€í”„ ê´€ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</li>
          </ul>
          <div class="mt-6">
            <a href="https://open.kakao.com/o/sgsXgqQh" target="_blank"
               class="rounded-lg border border-amber-300/40 px-4 py-2 text-sm hover:bg-amber-50 transition"
               onclick="gtag('event','click_consulting_cta',{plan:'standard'});">
              ìƒë‹´ìœ¼ë¡œ ì¶”ì²œ ë°›ê¸°
            </a>
          </div>
        </div>

        <div class="glass rounded-2xl p-6 relative ring-2 ring-amber-400/40">
          <div class="absolute -top-3 right-4 text-xs px-3 py-1 rounded-full rec-badge">ì¶”ì²œ</div>
          <div class="text-sm mb-2" style="color: var(--muted);">Deluxe</div>
          <h3 class="text-lg font-semibold">ìš°ë¦¬ ìˆ™ì†Œë§Œì˜ ì‹œê·¸ë‹ˆì²˜ í–¥ê¸°</h3>
          <ul class="mt-4 space-y-2 text-sm" style="color: var(--muted);">
            <li>â€¢ ì½˜ì…‰íŠ¸ ì •ì˜ + í–¥ í†¤ì•¤ë§¤ë„ˆ</li>
            <li>â€¢ ê³µê°„ë³„ ì‹œë‚˜ë¦¬ì˜¤ ì„¤ê³„</li>
            <li>â€¢ ìœ ì§€ê´€ë¦¬ ê°„ì†Œí™”</li>
          </ul>
          <div class="mt-6">
            <a href="https://open.kakao.com/o/sgsXgqQh" target="_blank"
               class="rounded-lg bg-gradient-to-r from-[var(--cta-from)] to-[var(--cta-to)] text-white font-semibold px-4 py-2 text-sm"
               onclick="gtag('event','click_consulting_cta',{plan:'deluxe'});">
              ìƒë‹´ìœ¼ë¡œ ì¶”ì²œ ë°›ê¸°
            </a>
          </div>
        </div>

        <div class="glass rounded-2xl p-6">
          <div class="text-sm mb-2" style="color: var(--muted);">Premium</div>
          <h3 class="text-lg font-semibold">í–¥ê¸° ë¸Œëœë”© í’€ì¼€ì–´</h3>
          <ul class="mt-4 space-y-2 text-sm" style="color: var(--muted);">
            <li>â€¢ ë¸Œëœë“œ ê²½í—˜ í†µí•©(ìŒì•…Â·ìƒ‰Â·í–¥)</li>
            <li>â€¢ í–¥ê¸° ì •ê¸° ë°°ì†¡ ê´€ë¦¬</li>
            <li>â€¢ ê³ ë„í™” ë¦¬í¬íŠ¸ ì œê³µ</li>
          </ul>
          <div class="mt-6">
            <a href="https://open.kakao.com/o/sgsXgqQh" target="_blank"
               class="rounded-lg border border-amber-300/40 px-4 py-2 text-sm hover:bg-amber-50 transition"
               onclick="gtag('event','click_consulting_cta',{plan:'premium'});">
              ìƒë‹´ìœ¼ë¡œ ì¶”ì²œ ë°›ê¸°
            </a>
          </div>
        </div>
      </div>

      <div class="mt-6 md:hidden">
        <button type="button"
          onclick="gtag('event','click_report_preview',{device:'mobile'}); showReportPreview();"
          class="w-full inline-flex justify-center items-center gap-2 shine rounded-xl bg-gradient-to-r from-purple-600 to-purple-700 text-white font-semibold px-5 py-3">
          ğŸ‘€ ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸°
        </button>
      </div>
    </section>

    <!-- Action/FAQ ì„¹ì…˜ì€ ì›ë³¸ê³¼ ë™ì¼ (ìƒëµ) -->
    <!-- ... ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ... -->

  </main>

  <!-- ===== ë™ì‘ ìŠ¤í¬ë¦½íŠ¸(íŒì—…/íƒ€ì´ë¨¸ ë“± ê¸°ì¡´ ìœ ì§€) ===== -->
  <script>
    function showPopup(){ document.getElementById('welcomePopup').classList.add('show'); }
    function closePopup(){ document.getElementById('welcomePopup').classList.remove('show'); }
    function showReportPreview(){ document.getElementById('reportPreview').classList.add('show'); }
    function closeReportPreview(){ document.getElementById('reportPreview').classList.remove('show'); }

    window.addEventListener('load', () => { setTimeout(showPopup, 2000); });
    document.getElementById('welcomePopup').addEventListener('click', (e) => { if (e.target === e.currentTarget) closePopup(); });
    document.getElementById('reportPreview').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeReportPreview(); });

    const liveApplicantsEl = document.getElementById('liveApplicants');
    let applicants = 86;
    if(liveApplicantsEl){
      setInterval(()=>{
        if(Math.random() > 0.6){
          applicants += 1;
          liveApplicantsEl.textContent = applicants.toLocaleString('ko-KR');
          liveApplicantsEl.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:300,easing:'ease-out'});
        }
      }, 4000);
    }

    function pad(n){ return String(n).padStart(2,'0'); }
    const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000;
    let targetDate = new Date(Date.now() + SEVEN_DAYS);
    const tbD = document.getElementById('tb-d'), tbH = document.getElementById('tb-h'), tbM = document.getElementById('tb-m'), tbS = document.getElementById('tb-s');
    function updateTimer(){
      const left = Math.max(0, targetDate.getTime() - Date.now());
      if (left === 0) { targetDate = new Date(Date.now() + SEVEN_DAYS); return; }
      const d = Math.floor(left / (24*60*60*1000));
      const h = Math.floor((left % (24*60*60*1000)) / (60*60*1000));
      const m = Math.floor((left % (60*60*1000)) / (60*1000));
      const s = Math.floor((left % (60*1000)) / 1000);
      if(tbD){tbD.textContent = pad(d)}; if(tbH){tbH.textContent = pad(h)}; if(tbM){tbM.textContent = pad(m)}; if(tbS){tbS.textContent = pad(s)};
    }
    updateTimer(); setInterval(updateTimer, 1000);

    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if(el){ e.preventDefault(); el.scrollIntoView({ behavior:'smooth', block:'start' }); }
      });
    });
  </script>

  <!-- ===== Analytics â†’ Google Sheet ===== -->
  <script>
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzKzArU4Y9Y__Of_LRvAs0DjcvwDdmoJTcd0rj6ZoRXcsM-69fZdLobeXD-2yB-vZjN/exec';

    function uuidv4(){ return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)); }
    const LS_VISITOR_KEY='vv_id', LS_SESSION_KEY='vv_sid', LS_SESSION_AT='vv_sid_at', SESSION_TTL_MS=30*60*1000;

    function getVisitorId(){ let id=localStorage.getItem(LS_VISITOR_KEY); if(!id){ id=uuidv4(); localStorage.setItem(LS_VISITOR_KEY,id);} return id; }
    function getSessionId(){
      const now=Date.now(); let sid=localStorage.getItem(LS_SESSION_KEY); let at=Number(localStorage.getItem(LS_SESSION_AT)||0);
      if(!sid || (now-at)>SESSION_TTL_MS){ sid=uuidv4(); }
      localStorage.setItem(LS_SESSION_KEY,sid); localStorage.setItem(LS_SESSION_AT,String(now)); return sid;
    }
    function getUTM(){
      const p=new URLSearchParams(location.search);
      const refHost=document.referrer ? (new URL(document.referrer)).host : '';
      return { utm_source:p.get('utm_source')||refHost, utm_medium:p.get('utm_medium')||'', utm_campaign:p.get('utm_campaign')||'', utm_content:p.get('utm_content')||'', utm_term:p.get('utm_term')||'' };
    }
    function deviceType(){ return /mobi|android|iphone|ipad/i.test(navigator.userAgent) ? 'mobile':'desktop'; }
    function screenSize(){ try{ return `${screen.width}x${screen.height}` } catch(e){ return '' } }

    function sendEvent(event, label='', extra={}){
      try{
        const payload = Object.assign({
          event, label,
          vid:getVisitorId(), sid:getSessionId(),
          page:location.href, ref:document.referrer||'',
          device:deviceType(), lang:navigator.language||'', screen:screenSize()
        }, getUTM(), extra);

        const bodyStr = JSON.stringify(payload);

        // í”„ë¦¬í”Œë¼ì´íŠ¸ ë°©ì§€: text/plain + beacon/keepalive
        if (navigator.sendBeacon) {
          navigator.sendBeacon(ENDPOINT, new Blob([bodyStr], {type:'text/plain;charset=UTF-8'}));
        } else {
          fetch(ENDPOINT, {
            method:'POST', mode:'no-cors', keepalive:true,
            headers:{ 'Content-Type':'text/plain;charset=UTF-8' },
            body: bodyStr
          }).catch(()=>{});
        }
      } catch(e){}
    }

    // === ë°”ì¸ë”© ===
    const pageStartAt = Date.now(); let ctaClicked=false;

    // 1) í˜ì´ì§€ë·°
    sendEvent('page_view');

    // 2) ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸° í´ë¦­
    document.querySelectorAll('[onclick*="showReportPreview"]').forEach(el=>{
      el.addEventListener('click', ()=> sendEvent('click_report_preview', 'report_button'));
    });

    // 3) ìƒë‹´ë°›ê¸° í´ë¦­
    document.querySelectorAll('a[onclick*="click_consulting_cta"]').forEach(a=>{
      const m=(a.getAttribute('onclick')||'').match(/plan:'([^']+)'/);
      const plan=m?m[1]:'';
      a.addEventListener('click', ()=>{ ctaClicked=true; sendEvent('click_consulting_cta', plan); });
    });

    // 4) ì‚¬ì „ì˜ˆì•½í•˜ê¸° í´ë¦­
    document.querySelectorAll('[onclick*="click_booking_cta"]').forEach(el=>{
      el.addEventListener('click', ()=>{
        ctaClicked=true;
        const m=(el.getAttribute('onclick')||'').match(/section:'([^']+)'/);
        sendEvent('click_booking_cta', m?m[1]:'');
      });
    });

    // 5) íŒì—… ì—´ë¦¼/CTA
    (function(){
      const nativeShowPopup = window.showPopup;
      if(typeof nativeShowPopup === 'function'){
        window.showPopup = function(){ sendEvent('popup_open'); return nativeShowPopup.apply(this, arguments); }
      }
    })();
    document.querySelectorAll('#welcomePopup a').forEach(a=>{
      a.addEventListener('click', ()=>{ ctaClicked=true; sendEvent('click_popup_cta', 'welcome_popup'); });
    });

    // 6) ì´íƒˆ(ì¢…ë£Œ)
    function sendExit(){
      const dur=Date.now()-pageStartAt;
      const maxScroll=Math.max(1, document.documentElement.scrollHeight - window.innerHeight);
      const scrollPct=Math.round(Math.max(0, Math.min(100, (window.scrollY / maxScroll) * 100)));
      sendEvent('exit', ctaClicked ? 'with_interaction':'bounce', { dur_ms:dur, scroll:scrollPct, cta_clicked:ctaClicked });
    }
    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') sendExit(); });
    window.addEventListener('beforeunload', sendExit);
  </script>

  <!-- GTM noscript -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWT63X64" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
</body>
</html>
